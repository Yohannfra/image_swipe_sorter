#include "render.h"

/* 5x7 bitmap font for basic characters */
static const unsigned char font_5x7[128][7] = {
    ['<'] = {0x04, 0x08, 0x10, 0x08, 0x04, 0x00, 0x00},
    ['>'] = {0x10, 0x08, 0x04, 0x08, 0x10, 0x00, 0x00},
    ['-'] = {0x00, 0x00, 0x1F, 0x00, 0x00, 0x00, 0x00},
    ['A'] = {0x0E, 0x11, 0x11, 0x1F, 0x11, 0x11, 0x00},
    ['B'] = {0x1E, 0x11, 0x1E, 0x11, 0x11, 0x1E, 0x00},
    ['C'] = {0x0E, 0x11, 0x10, 0x10, 0x11, 0x0E, 0x00},
    ['D'] = {0x1E, 0x11, 0x11, 0x11, 0x11, 0x1E, 0x00},
    ['E'] = {0x1F, 0x10, 0x1E, 0x10, 0x10, 0x1F, 0x00},
    ['F'] = {0x1F, 0x10, 0x1E, 0x10, 0x10, 0x10, 0x00},
    ['G'] = {0x0E, 0x11, 0x10, 0x17, 0x11, 0x0E, 0x00},
    ['H'] = {0x11, 0x11, 0x1F, 0x11, 0x11, 0x11, 0x00},
    ['I'] = {0x0E, 0x04, 0x04, 0x04, 0x04, 0x0E, 0x00},
    ['K'] = {0x11, 0x12, 0x1C, 0x12, 0x11, 0x11, 0x00},
    ['L'] = {0x10, 0x10, 0x10, 0x10, 0x10, 0x1F, 0x00},
    ['N'] = {0x11, 0x19, 0x15, 0x13, 0x11, 0x11, 0x00},
    ['O'] = {0x0E, 0x11, 0x11, 0x11, 0x11, 0x0E, 0x00},
    ['P'] = {0x1E, 0x11, 0x1E, 0x10, 0x10, 0x10, 0x00},
    ['R'] = {0x1E, 0x11, 0x1E, 0x14, 0x12, 0x11, 0x00},
    ['S'] = {0x0E, 0x10, 0x0E, 0x01, 0x01, 0x0E, 0x00},
    ['T'] = {0x1F, 0x04, 0x04, 0x04, 0x04, 0x04, 0x00},
    ['U'] = {0x11, 0x11, 0x11, 0x11, 0x11, 0x0E, 0x00},
    ['W'] = {0x11, 0x11, 0x11, 0x15, 0x15, 0x0A, 0x00},
    ['/'] = {0x01, 0x02, 0x04, 0x08, 0x10, 0x00, 0x00},
    [':'] = {0x00, 0x04, 0x00, 0x00, 0x04, 0x00, 0x00},
    ['0'] = {0x0E, 0x13, 0x15, 0x19, 0x11, 0x0E, 0x00},
    ['1'] = {0x04, 0x0C, 0x04, 0x04, 0x04, 0x0E, 0x00},
    ['2'] = {0x0E, 0x11, 0x02, 0x04, 0x08, 0x1F, 0x00},
    ['3'] = {0x0E, 0x01, 0x06, 0x01, 0x11, 0x0E, 0x00},
    ['4'] = {0x02, 0x06, 0x0A, 0x1F, 0x02, 0x02, 0x00},
    ['5'] = {0x1F, 0x10, 0x1E, 0x01, 0x11, 0x0E, 0x00},
    ['6'] = {0x0E, 0x10, 0x1E, 0x11, 0x11, 0x0E, 0x00},
    ['7'] = {0x1F, 0x01, 0x02, 0x04, 0x08, 0x08, 0x00},
    ['8'] = {0x0E, 0x11, 0x0E, 0x11, 0x11, 0x0E, 0x00},
    ['9'] = {0x0E, 0x11, 0x0F, 0x01, 0x11, 0x0E, 0x00},
};

void render_text(SDL_Renderer *renderer, const char *text, int x, int y, int scale)
{
    int cursor_x = x;
    for (int i = 0; text[i]; i++) {
        unsigned char c = (unsigned char)text[i];
        if (c == ' ') {
            cursor_x += 6 * scale;
            continue;
        }
        if (c < 128) {
            for (int row = 0; row < 7; row++) {
                unsigned char bits = font_5x7[c][row];
                for (int col = 0; col < 5; col++) {
                    if (bits & (0x10 >> col)) {
                        SDL_Rect pixel = {cursor_x + col * scale, y + row * scale, scale, scale};
                        SDL_RenderFillRect(renderer, &pixel);
                    }
                }
            }
        }
        cursor_x += 6 * scale;
    }
}

void render_arrow(SDL_Renderer *renderer, int x, int y, int size, int direction)
{
    int half = size / 2;
    int shaft_height = size / 3;

    if (direction < 0) {
        /* Left arrow: point at left, shaft extends right */
        for (int row = -half; row <= half; row++) {
            int width = half - abs(row);
            if (width > 0) {
                SDL_RenderDrawLine(renderer, x + half - width, y + row, x + half, y + row);
            }
        }
        SDL_Rect shaft = {x + half, y - shaft_height, half, shaft_height * 2};
        SDL_RenderFillRect(renderer, &shaft);
    } else {
        /* Right arrow: shaft on left, point at right */
        SDL_Rect shaft = {x, y - shaft_height, half, shaft_height * 2};
        SDL_RenderFillRect(renderer, &shaft);
        for (int row = -half; row <= half; row++) {
            int width = half - abs(row);
            if (width > 0) {
                SDL_RenderDrawLine(renderer, x + half, y + row, x + half + width, y + row);
            }
        }
    }
}
